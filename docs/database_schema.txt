# BSIT Enrollment System - Database Schema

This document outlines the proposed database schema for the BSIT Enrollment System. The structure is designed to be relational and can be implemented in SQL or adapted for a NoSQL database like Firestore.

---

### 1. `users` Table
Stores authentication and basic profile information for all user types in the system (students, instructors, and administrators).

| Column          | Type         | Description                                                 | Notes                                    |
|-----------------|--------------|-------------------------------------------------------------|------------------------------------------|
| `id`            | UUID/String  | Primary Key. Unique identifier for the user.                | e.g., Firebase Authentication UID        |
| `email`         | String       | User's email address. Must be unique.                       | Used for login.                          |
| `password_hash` | String       | Hashed password for email/password authentication.          |                                          |
| `role`          | Enum         | Defines the user's role: 'student', 'instructor', 'admin'.  | Critical for access control.             |
| `created_at`    | Timestamp    | Timestamp of when the user account was created.             |                                          |

---

### 2. `student_profiles` Table
Stores detailed information specific to students. This table has a one-to-one relationship with the `users` table.

| Column                | Type        | Description                                                 | Notes                                                     |
|-----------------------|-------------|-------------------------------------------------------------|-----------------------------------------------------------|
| `user_id`             | UUID/String | Primary Key / Foreign Key to `users.id`.                    |                                                           |
| `student_id_number`   | String      | The official student number (e.g., "21-00-0123"). Unique.   |                                                           |
| `name`                | String      | Full name of the student.                                   |                                                           |
| `avatar_url`          | String      | URL to the student's profile picture.                       |                                                           |
| `course`              | Enum        | 'BSIT' or 'ACT'.                                            |                                                           |
| `year_level`          | Integer     | The student's current year (1, 2, 3, 4).                    |                                                           |
| `enrollment_status`   | Enum        | 'Enrolled', 'Not Enrolled', 'Graduated'.                    |                                                           |
| `promotion_hold_reason` | Text      | Optional note explaining why a student was held back.       | Set when a rollover identifies incomplete requirements.   |
| `block_id`            | UUID/String | Foreign Key to `blocks.id`. Nullable.                       | Null if not currently enrolled in a block.                |
| `specialization`      | Enum        | 'AP' (Application Programming), 'DD' (Digital Design). Nullable. | Null for 1st/2nd year and ACT students.                   |
| `sex`                 | Enum        | 'Male', 'Female'.                                           |                                                           |
| `phone_number`        | String      | Student's contact number.                                   |                                                           |
| `...personal_details` | JSON/Text   | Additional fields from the enrollment form (address, etc.). | Can be stored as a JSON object for flexibility.           |

---

### 3. `instructor_profiles` Table
Stores detailed information specific to instructors. One-to-one relationship with the `users` table.

| Column        | Type        | Description                                       | Notes                                      |
|---------------|-------------|---------------------------------------------------|--------------------------------------------|
| `user_id`     | UUID/String | Primary Key / Foreign Key to `users.id`.          |                                            |
| `name`        | String      | Full name of the instructor.                      |                                            |
| `avatar_url`  | String      | URL to the instructor's profile picture.          |                                            |
| `department`  | String      | Department the instructor belongs to (e.g., "IT").|                                            |

---

### 4. `admin_profiles` Table
Stores detailed information specific to administrators. One-to-one relationship with the `users` table.

| Column       | Type        | Description                                 | Notes                                  |
|--------------|-------------|---------------------------------------------|----------------------------------------|
| `user_id`    | UUID/String | Primary Key / Foreign Key to `users.id`.    |                                        |
| `name`       | String      | Full name of the administrator.             |                                        |
| `avatar_url` | String      | URL to the administrator's profile picture. |                                        |
| `admin_role` | Enum        | 'Super Admin', 'Admin', 'Moderator'.        | Fine-grained permissions within the admin portal. |

---

### 5. `subjects` Table
A master list of all subjects offered by the institution.

| Column          | Type        | Description                                | Notes                                    |
|-----------------|-------------|--------------------------------------------|------------------------------------------|
| `id`            | UUID/String | Primary Key.                               |                                          |
| `code`          | String      | The unique subject code (e.g., "IT 101").  | Indexed for fast lookups.                |
| `description`   | String      | Full description of the subject.           |                                          |
| `units`         | Integer     | Number of academic units for the subject.  |                                          |
| `prerequisite_id` | UUID/String | Foreign Key to `subjects.id`. Nullable.    | Backward-compatible pointer to the primary prerequisite (if any). |
| `year_level`    | Integer     | The year level this subject is intended for. | e.g., 1, 2, 3, 4                         |

#### `subject_prerequisites` Junction Table
Multi-prerequisite support is stored in a dedicated pivot table so a subject can require multiple other subjects.

| Column                   | Type        | Description                                 | Notes                                      |
|--------------------------|-------------|---------------------------------------------|--------------------------------------------|
| `subject_id`             | UUID/String | Foreign Key to `subjects.id`.               | The dependent subject.                     |
| `prerequisite_subject_id`| UUID/String | Foreign Key to `subjects.id`.               | The required subject that must be completed beforehand. |

All prerequisite relationships should be recorded here. The legacy `prerequisite_id` column on `subjects` mirrors the first prerequisite (if any) for compatibility with older tooling.

---

### 6. `blocks` Table
Represents a class section for a specific year level and course.

| Column         | Type        | Description                                                 | Notes                                                |
|----------------|-------------|-------------------------------------------------------------|------------------------------------------------------|
| `id`           | UUID/String | Primary Key.                                                |                                                      |
| `name`         | String      | The unique name of the block (e.g., "BSIT 3-A").            |                                                      |
| `year_level`   | Integer     | The year level this block is for.                           |                                                      |
| `course`       | Enum        | 'BSIT' or 'ACT'.                                            |                                                      |
| `specialization` | Enum        | 'AP', 'DD'. Nullable.                                       | Required for 3rd/4th year BSIT blocks.               |
| `capacity`     | Integer     | Maximum number of students allowed.                         |                                                      |

---

### 7. `schedules` Table (Junction Table)
Defines the schedule for each subject within a specific block, taught by a specific instructor.

| Column         | Type        | Description                             | Notes                                 |
|----------------|-------------|-----------------------------------------|---------------------------------------|
| `id`           | UUID/String | Primary Key.                            |                                       |
| `block_id`     | UUID/String | Foreign Key to `blocks.id`.             | Part of a composite key for uniqueness. |
| `subject_id`   | UUID/String | Foreign Key to `subjects.id`.           | Part of a composite key for uniqueness. |
| `instructor_id`| UUID/String | Foreign Key to `users.id`. Nullable.    | The instructor handling this class.   |
| `day_of_week`  | Enum        | 'Monday', 'Tuesday', etc.               |                                       |
| `start_time`   | Time        | The start time of the class.            |                                       |
| `end_time`     | Time        | The end time of the class.              |                                       |
| `room`         | String      | The room/laboratory for the class.      |                                       |

---

### 8. `student_grades` Table
Stores the computed (final) academic records for each student and subject pairing.

| Column              | Type        | Description                                                 | Notes                                                          |
|---------------------|-------------|-------------------------------------------------------------|----------------------------------------------------------------|
| `id`                | Integer     | Primary Key.                                                | Auto-increment.                                                |
| `student_user_id`   | Integer     | Foreign Key to `users.id`.                                  | Identifies the student.                                        |
| `subject_id`        | Integer     | Foreign Key to `subjects.id`.                               | Identifies the subject.                                        |
| `grade`             | Decimal     | Final numerical grade. Nullable until all terms are posted. | Rounded weighted average of the term grades.                   |
| `academic_year`     | String      | Academic year the grade was earned (e.g., "2025-2026").    | Part of the uniqueness constraint per student/subject/term.    |
| `semester`          | String      | Semester code (e.g., `1st-sem`, `2nd-sem`).                 | Part of the uniqueness constraint.                             |
| `instructor_user_id`| Integer     | Foreign Key to `users.id`. Nullable.                        | Instructor who last updated the grade.                         |
| `remark`            | Enum        | 'Passed', 'Failed', 'Incomplete', 'Dropped', 'In Progress'. | Auto-derived unless overridden manually.                       |
| `graded_at`         | Datetime    | Timestamp of the latest final grade computation.           | Null while the grade is still in progress.                     |

---

### 9. `student_grade_terms` Table
Captures individual grading-period scores (prelim, midterm, final) that roll up into `student_grades`.

| Column            | Type        | Description                                               | Notes                                                 |
|-------------------|-------------|-----------------------------------------------------------|-------------------------------------------------------|
| `id`              | Integer     | Primary Key.                                              | Auto-increment.                                       |
| `student_grade_id`| Integer     | Foreign Key to `student_grades.id`.                       | Cascades on delete.                                   |
| `term`            | Enum        | 'prelim', 'midterm', or 'final'.                          | Uniquely identifies the grading period per row.       |
| `grade`           | Decimal     | Raw grade for the specific term. Nullable.                | Accepts the same numeric scale (1.0 - 5.0).           |
| `weight`          | Decimal     | Weight contribution of the term to the final grade.       | Defaults to 0.30/0.30/0.40 for prelim/midterm/final.  |
| `encoded_at`      | Datetime    | Timestamp when the term grade was last captured.          | Used for audit/history.                               |

---

### 10. `system_settings` Table
Stores global academic term configuration.

| Column                  | Type     | Description                                        | Notes |
|-------------------------|----------|----------------------------------------------------|-------|
| `id`                    | Integer  | Primary Key.                                       | Single-row configuration table. |
| `academic_year`         | String   | Active academic year (e.g., "2025-2026").         | |
| `semester`              | String   | Active semester code (e.g., `1st-sem`).            | |
| `enrollment_start_date` | Date     | Optional enrollment start date for the term.       | |
| `enrollment_end_date`   | Date     | Optional enrollment end date for the term.         | |
| `phased_schedule_json`  | JSON     | Serialized phased schedule per year level.         | Stores date/time slots for staggered enrollment. |
| `updated_at`            | Timestamp| Automatically updated when the record changes.     | |

---

### 11. `student_enrollment_history` Table
Keeps an audit log of enrollment states per academic term.

| Column             | Type     | Description                                            | Notes |
|--------------------|----------|--------------------------------------------------------|-------|
| `id`               | Integer  | Primary Key.                                           | |
| `student_user_id`  | Integer  | Foreign Key to `student_profiles.user_id`.             | |
| `academic_year`    | String   | Academic year the record applies to.                  | |
| `semester`         | String   | Semester code for the record.                         | |
| `status`           | Enum     | 'Pending', 'Enrolled', 'Not Enrolled', 'Graduated', 'Hold'. | |
| `notes`            | Text     | Additional context (e.g., hold reasons).              | |
| `created_at`       | Timestamp| Auto-generated timestamp.                             | |

---

### 12. `academic_rollover_logs` Table
Summarizes each academic rollover execution.

| Column                 | Type     | Description                                            | Notes |
|------------------------|----------|--------------------------------------------------------|-------|
| `id`                   | Integer  | Primary Key.                                           | |
| `triggered_by_user_id` | Integer  | Foreign Key to `users.id` for the admin who ran it.    | Nullable; set to NULL if user deleted. |
| `closing_academic_year`| String   | Academic year that was closed.                         | |
| `closing_semester`     | String   | Semester that was closed.                              | |
| `next_academic_year`   | String   | Academic year activated.                               | |
| `next_semester`        | String   | Semester activated.                                    | |
| `promoted_count`       | Integer  | Number of students promoted.                           | |
| `held_count`           | Integer  | Number of students held for manual review.             | |
| `graduated_count`      | Integer  | Number of students marked as graduated.                | |
| `notes`                | Text     | Optional admin notes or summary text.                  | |
| `created_at`           | Timestamp| Auto-generated timestamp.                              | |

---

### 13. `academic_rollover_actions` Table
Per-student breakdown for each rollover.

| Column              | Type     | Description                                              | Notes |
|---------------------|----------|----------------------------------------------------------|-------|
| `id`                | Integer  | Primary Key.                                             | |
| `rollover_log_id`   | Integer  | Foreign Key to `academic_rollover_logs.id`.              | |
| `student_user_id`   | Integer  | Foreign Key to `student_profiles.user_id`.               | |
| `previous_year_level`| Integer | Student year level before rollover.                     | |
| `new_year_level`    | Integer  | Student year level after rollover.                      | |
| `action`            | Enum     | 'promoted', 'held', or 'graduated'.                      | |
| `reason`            | Text     | Optional note describing the decision.                  | |
| `created_at`        | Timestamp| Auto-generated timestamp.                               | |

---

### 14. `enrollment_applications` Table
A temporary table to hold pending enrollment applications for admin review.

| Column           | Type        | Description                                          | Notes                                                     |
|------------------|-------------|------------------------------------------------------|-----------------------------------------------------------|
| `id`             | UUID/String | Primary Key.                                         |                                                           |
| `student_user_id`  | UUID/String | Foreign Key to `users.id`.                           | The student who is applying.                              |
| `status`         | Enum        | 'pending', 'approved', 'rejected'.                   |                                                           |
| `block_name`     | String      | The name of the block the student applied for.       | From the form submission.                                 |
| `submitted_at`   | Timestamp   | When the application was submitted.                  |                                                           |
| `rejection_reason` | String      | Reason for rejection, if applicable. Nullable.     |                                                           |
| `form_data`      | JSON/Text   | A snapshot of all the data from the enrollment form. | Useful for review and record-keeping.                     |